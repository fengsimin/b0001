<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\x74\x61\x2f\146\151\156\144\x65\x72\57"; function __construct() { goto WBts5; WBts5: if ($this->table) { goto o7KDh; } goto eHJl3; eHJl3: $this->table = "\x66\151\x6e\144\145\162"; goto RsGyf; OLCFR: parent::__construct(); goto x1hgX; RsGyf: o7KDh: goto OLCFR; x1hgX: } protected function postAll($pid, $request_data) { goto NOec_; GGXmG: c4e2z: goto U7XUi; U7XUi: return array("\146\x69\154\x65\163" => $files, "\x70\x61\164\150\163" => $paths); goto KqqWm; jrvsj: $level = $this->db->select($this->table, "\x6c\x65\166\145\154")->where(array("\151\144", "\x3d", $pid))->get(0); goto hKhIg; Qb0sQ: $paths = $this->db->select($this->table, array("\151\144", "\x6e\x61\x6d\145"))->where(array("\151\x64", "\x49\x4e", $level), "\101\116\104", array("\x74\171\x70\x65", "\x3d", "\146\x6f\x6c\144\145\162"))->all(); goto GGXmG; hKhIg: $level = array_filter(explode("\x2c", $level)); goto Qb0sQ; TOktc: $paths = array(); goto S2Bzj; S2Bzj: if (!$pid) { goto c4e2z; } goto jrvsj; NOec_: $files = $this->db->select($this->table)->where($request_data["\167\x68\145\x72\x65"])->order($request_data["\157\x72\144\x65\x72"])->all(); goto TOktc; KqqWm: } protected function postAdd($request_data) { goto i29yX; QdIEA: Wt3Ti: goto qZJsq; K_RxT: $data["\x65\170\164"] = end(explode("\56", $name)); goto yBRVK; y6G9u: return $this->error("\xe4\xb8\x8a\344\274\240\xe6\226\207\xe4\273\266\40" . $name . "\40\xe5\244\261\xe8\xb4\xa5\xef\274\x81"); goto Ri5MF; i29yX: $path = $request_data["\x70\141\x74\x68"]; goto MFxuE; MFxuE: $name = $request_data["\156\x61\x6d\145"]; goto BE06Y; Ivb0p: $foid = $request_data["\x66\x6f\x69\x64"]; goto XVASW; XGrKx: return $this->success(); goto IFagI; IFagI: t1kp8: goto Ormu8; Ormu8: $this->db->rollBack(); goto Kf5ok; gDD4w: if (!$this->db->update($this->table, array("\x6c\145\166\x65\x6c" => $level), array("\x69\144", "\75", $id))->is()) { goto t1kp8; } goto AZgp1; LwENe: $data["\x70\x61\x74\x68"] = $path; goto bOwON; BE06Y: $type = mime_content_type("\x2e\56\x2f" . $path . $name); goto Ivb0p; oMfom: $imagesize = getimagesize($filename); goto ZKF7O; Ksh1J: if (mkdir($this->_UTF82GBK("\x2e\56\x2f" . $path), 511, true)) { goto Wt3Ti; } goto S4TCs; PXh9n: $this->db->rollBack(); goto y6G9u; MAjVY: $data["\163\x69\x7a\x65"] = $request_data["\x73\151\172\x65"]; goto ubemN; KFxY7: if ($id = $this->db->insert($this->table, $data)->id()) { goto O2L5J; } goto D7E07; S4TCs: return $this->error("\345\210\x9b\xe5\xbb\xba\346\226\x87\344\xbb\266\xe5\244\xb9\xe5\244\261\350\264\245\357\274\201"); goto QdIEA; D7E07: unlink($filename); goto PXh9n; Qbt8G: $data["\x70\x69\x64"] = $foid ? $foid : 0; goto MAjVY; Dipa1: $data["\164\171\x70\145"] = $type; goto Qbt8G; vNhhw: $level = $this->_getLevel($id); goto gDD4w; Kf5ok: return $this->error("\xe4\xb8\212\344\xbc\240\xe6\x96\x87\344\273\266\40" . $name . "\x20\xe5\244\xb1\xe8\xb4\245\357\274\201"); goto XQyNh; XVASW: if (is_dir($this->_UTF82GBK("\56\56\57" . $path))) { goto OmB4E; } goto Ksh1J; pjgh4: if (!(stripos($type, "\x69\x6d\x61\x67\145") !== false && is_file($filename))) { goto UBdaU; } goto oMfom; ubemN: $data["\143\164\x69\x6d\145"] = time(); goto K_RxT; Ri5MF: O2L5J: goto vNhhw; AZgp1: $this->db->commit(); goto XGrKx; yBRVK: $this->db->beginTransaction(); goto KFxY7; ZKF7O: $data["\167\x69\144\x74\150"] = $imagesize[0]; goto S2ULe; S2ULe: $data["\x68\x65\151\147\150\164"] = $imagesize[1]; goto od8Jx; od8Jx: UBdaU: goto LwENe; Z6nqR: $filename = $this->_UTF82GBK("\x2e\x2e\57" . $path . $name); goto pjgh4; bOwON: $data["\x6e\x61\155\145"] = $name; goto Dipa1; qZJsq: OmB4E: goto Z6nqR; XQyNh: } protected function postMkdir($request_data) { goto p2niT; OAELj: if ($this->db->update($this->table, array("\154\x65\x76\145\154" => $level), array("\151\144", "\75", $id))->is()) { goto AoR2a; } goto mLIPw; Q7Hbx: $dirname = $this->_UTF82GBK("\x2e\56\57" . $this->root . $folder_path . $name); goto PooHg; dSzTj: if (!($name === null || $name === '')) { goto kuF9W; } goto qBpeo; Fl6y_: $data["\x73\157\162\164\142\171"] = 1; goto GUa3w; md0iM: $data["\160\141\x74\150"] = $this->root . $folder_path; goto Fl6y_; J68oA: $data = array(); goto Gyb8O; qBpeo: return $this->error("\346\227\xa0\xe6\225\x88\347\232\204\345\x8f\x82\xe6\225\260\xef\xbc\201"); goto whhWq; mLIPw: rmdir($dirname); goto LED3z; BOJY0: fLjBY: goto Q7Hbx; nLBsp: AoR2a: goto K6Og8; umD2X: pGfDc: goto TfILF; whhWq: kuF9W: goto J68oA; p2niT: $pid = $request_data["\x70\x69\x64"]; goto raP0a; xI05w: return $this->error($name . "\x20\xe6\x96\207\xe4\xbb\xb6\345\xa4\271\345\267\262\345\255\x98\xe5\x9c\xa8\357\xbc\x81"); goto umD2X; MYyQl: BpIBb: goto BOJY0; kYrf5: $data["\143\164\151\x6d\x65"] = time(); goto nK0ba; VBhZ7: $folder_path = ''; goto g2DHP; vf2oG: UJDcz: goto B3JOi; kxvBh: return $this->error("\345\210\x9b\xe5\xbb\272\xe6\226\207\xe4\xbb\xb6\345\xa4\xb9\xe5\xa4\261\350\264\245\xef\xbc\201"); goto KD_J_; rDLIx: $data["\160\x69\144"] = $pid; goto VBhZ7; qzvno: rmdir($dirname); goto BMib5; KD_J_: goto u4nj0; goto nLBsp; g2DHP: $level = $this->db->select($this->table, "\140\x6c\x65\x76\145\154\140")->where(array("\x69\x64", "\x3d", $pid))->get(0); goto jH1jL; NfodS: u4nj0: goto ERDYN; XiJCJ: $level = array_filter(explode("\54", $level)); goto pzB4j; Gyb8O: $data["\x6e\x61\x6d\145"] = $name; goto rDLIx; GUa3w: $data["\164\171\x70\x65"] = "\x66\x6f\154\x64\145\x72"; goto kYrf5; TfILF: if (mkdir($dirname, 493, true)) { goto aJIpg; } goto h68gx; QYPaD: foreach ($folder as $value) { $folder_path .= $value["\156\x61\155\145"] . "\57"; K3tkT: } goto MYyQl; raP0a: $name = $request_data["\156\141\155\145"]; goto dSzTj; K6Og8: $this->db->commit(); goto t4g0Q; h68gx: return $this->error("\xe5\x88\x9b\345\273\xba\346\x96\207\344\xbb\266\345\244\xb9\345\xa4\261\xe8\264\245\357\274\201"); goto H4YEz; SsnnL: $this->db->beginTransaction(); goto md0iM; B3JOi: $level = $this->_getLevel($id); goto OAELj; pzB4j: $folder = $this->db->select($this->table, "\140\156\x61\155\145\x60")->where(array("\x69\144", "\111\116", $level), "\101\116\104", array("\164\171\160\x65", "\75", "\146\157\x6c\x64\x65\162"))->all(); goto QYPaD; egP3O: return $this->error("\xe5\210\233\345\273\xba\346\226\207\344\273\266\345\xa4\271\345\244\261\xe8\264\245\xef\274\201"); goto vf2oG; nK0ba: if ($id = $this->db->insert($this->table, $data)->id()) { goto UJDcz; } goto qzvno; H4YEz: aJIpg: goto SsnnL; jH1jL: if (!$level) { goto fLjBY; } goto XiJCJ; BMib5: $this->db->rollBack(); goto egP3O; LED3z: $this->db->rollBack(); goto kxvBh; t4g0Q: return $this->success(); goto NfodS; PooHg: if (!is_dir($dirname)) { goto pGfDc; } goto xI05w; ERDYN: } protected function postRename($request_data) { goto whqbx; FLeQS: apZ4r: goto ukB2R; meJZI: NRkgO: goto FLeQS; twJOH: lbYDI: goto oxmeW; Vbuf1: c1gao: goto ETwBB; BHU2j: goto FmOdP; goto FH6Uf; Ezwhl: n3CmF: goto SOS0M; zxXO6: $this->db->rollBack(); goto gKRyX; KJKna: BK60V: goto pDhXs; usrz6: return $this->error($name . "\x20\346\x96\207\344\xbb\xb6\xe5\244\xb9\xe5\xb7\262\345\xad\x98\xe5\234\250\357\274\x81"); goto ZOfjp; Q9RvN: goto NRkgO; goto xlR6m; vVfKU: if (is_file($oldname)) { goto lbYDI; } goto DDG9p; Poe9N: B5rEJ: goto r8rfC; uhZBo: $path = $finder["\x70\141\164\150"]; goto iw4yW; dxTgn: $newname = $this->_UTF82GBK("\56\x2e\57" . $path . $name); goto VBsW2; hsufK: $this->db->commit(); goto Wi1_3; Exnsi: if (rename($oldname, $newname)) { goto bqlxP; } goto cLB_m; iIyl4: goto c1gao; goto twJOH; VBsW2: $this->db->beginTransaction(); goto vVfKU; DQQqI: goto B5rEJ; goto D2yfy; r8rfC: FmOdP: goto MRUoc; ftkrj: foreach ($sublist as $sub) { goto zPaeA; yLVGO: foreach ($level as $lid) { goto uvQck; qf1x5: if (!($sub["\164\171\x70\145"] == "\x66\x6f\154\144\x65\162" && $sub["\x6c\145\x76\145\x6c"] == $levelobj["\x6c\x65\166\x65\154"])) { goto znps9; } goto me2fn; me2fn: goto pX4BY; goto wl5ed; uvQck: $levelobj = $this->db->select($this->table, array("\x6e\x61\x6d\x65", "\154\145\166\145\x6c"))->where("\x69\x64\x20\75\x20{$lid}\40\101\116\x44\40\164\x79\160\x65\40\x3d\40\47\146\157\154\x64\145\162\x27")->get(); goto qf1x5; BVq5q: $newpath .= $level_name != '' ? $level_name . "\57" : ''; goto PnZzN; StBKF: $level_name = $levelobj["\x6e\x61\x6d\x65"]; goto BVq5q; PnZzN: pX4BY: goto ejyho; wl5ed: znps9: goto StBKF; ejyho: } goto hf2Y1; gB0Dq: if (!($is_path_update === false)) { goto t0Il5; } goto X7Dgk; vQw3G: Dt2SV: goto Fb3zC; hf2Y1: n_mvw: goto VkICE; dIluk: goto Dt2SV; goto LbEIF; llIHZ: $level = array_filter(explode("\x2c", $sub["\154\x65\166\145\154"])); goto yLVGO; X7Dgk: goto X00EA; goto tYbo4; VkICE: $is_path_update = $this->db->update($this->table, array("\x70\x61\164\x68" => $this->root . $newpath), array("\x69\144", "\x3d", $sub["\x69\x64"]))->is(); goto gB0Dq; tYbo4: t0Il5: goto vQw3G; FEbqe: $newpath = ''; goto llIHZ; zPaeA: if (!($sub["\154\145\x76\145\154"] == $finder["\x6c\145\x76\145\154"])) { goto an9ET; } goto dIluk; LbEIF: an9ET: goto FEbqe; Fb3zC: } goto saeUT; JnLfD: return $this->error("\xe6\x97\240\xe6\225\210\xe7\x9a\x84\xe8\xb7\257\xe5\xbe\x84\xef\xbc\201"); goto KJKna; N28SI: L7ra2: goto bINgR; tu5Dp: Fxn5G: goto Cj3IK; zbrTV: if ($is_path_update !== false) { goto eOK9j; } goto mkR_E; oxmeW: if ($this->db->update($this->table, array("\x6e\141\x6d\x65" => $name), array("\x69\x64", "\75", $id))->is()) { goto ZSDot; } goto rsubP; Y2jBl: $sublist = $this->db->select($this->table, array("\x69\144", "\x6c\x65\x76\145\154", "\x74\x79\x70\x65"))->where(array("\x6c\145\166\x65\x6c", "\x4c\111\113\105", "\x25\54{$id}\x2c\45"))->all(); goto ftkrj; civxc: return $this->error("\346\x89\276\xe4\270\215\345\210\260\xe9\207\215\xe5\x91\xbd\xe5\x90\215\347\232\x84\xe6\x96\207\344\273\xb6\x2f\xe6\x96\207\344\xbb\266\xe5\244\271\xef\274\x81"); goto iIyl4; ZCKk0: $this->db->rollBack(); goto usrz6; GgMtq: return $this->error("\xe6\226\207\344\xbb\266\xe9\x87\215\xe5\x91\xbd\xe5\220\215\345\244\261\xe8\xb4\xa5\357\xbc\x81"); goto BHU2j; iw4yW: if (!(!$path || stripos($path, $this->root) === false)) { goto BK60V; } goto JnLfD; gKRyX: return $this->error("\346\226\x87\xe4\xbb\266\345\244\xb9\xe9\207\x8d\xe5\221\275\xe5\220\x8d\345\xa4\xb1\350\264\245\357\274\x81"); goto Q9RvN; JAlcO: return $this->success(); goto meJZI; MRUoc: goto c1gao; goto tu5Dp; ZOfjp: goto apZ4r; goto Dfm7d; Dfm7d: JFPU9: goto Y2jBl; ljD0z: return $this->error("\346\227\xa0\xe6\225\210\xe7\x9a\x84\345\217\202\346\225\xb0\xef\274\x81"); goto N28SI; WxP6D: $name = $request_data["\156\141\155\145"]; goto gCaMe; cLB_m: $this->db->rollBack(); goto p7csa; saeUT: X00EA: goto zbrTV; Wi1_3: return $this->success(); goto Poe9N; EquST: $this->db->rollBack(); goto IVe0u; Ya33o: $this->db->commit(); goto JAlcO; FH6Uf: ZSDot: goto Exnsi; IVe0u: return $this->error("\xe6\226\x87\xe4\xbb\xb6\345\244\271\351\207\x8d\345\221\275\xe5\x90\215\xe5\xa4\xb1\xe8\264\245\357\xbc\201"); goto c6TuB; DDG9p: if (is_dir($oldname)) { goto Fxn5G; } goto civxc; c6TuB: goto vz0sT; goto Ezwhl; xlR6m: eOK9j: goto Ya33o; mkR_E: rename($newname, $oldname); goto zxXO6; SOS0M: if (rename($oldname, $newname)) { goto JFPU9; } goto ZCKk0; bINgR: $finder = $this->db->select($this->table, array("\160\141\164\150", "\x6e\141\155\x65", "\154\145\x76\145\x6c"))->where(array("\x69\144", "\75", $id))->get(); goto uhZBo; gCaMe: if (!(!$id || $name === null || $name === '')) { goto L7ra2; } goto ljD0z; Cj3IK: if ($this->db->update($this->table, array("\156\x61\155\145" => $name), array("\151\x64", "\75", $id))->is()) { goto n3CmF; } goto EquST; ukB2R: vz0sT: goto Vbuf1; D2yfy: bqlxP: goto hsufK; pDhXs: $oldname = $this->_UTF82GBK("\x2e\x2e\x2f" . $path . $finder["\156\141\x6d\x65"]); goto dxTgn; whqbx: $id = $request_data["\151\144"]; goto WxP6D; p7csa: return $this->error("\xe6\x96\207\xe4\273\266\xe9\x87\215\345\221\275\345\220\x8d\xe5\xa4\261\350\264\245\xef\274\201"); goto DQQqI; rsubP: $this->db->rollBack(); goto GgMtq; ETwBB: } protected function postIsFile($request_data) { goto WLWHu; OuV1P: BqD5F: goto uMIBQ; m9Xpb: if (file_exists($this->_UTF82GBK("\x2e\56\57" . $path . $name))) { goto i3Xel; } goto WHDDV; ANOIF: goto BqD5F; goto kgBc4; wujvt: $name = $request_data["\156\x61\155\x65"]; goto m9Xpb; cLgfW: return $this->success($name . "\40\xe6\x96\x87\xe4\273\xb6\xe5\267\xb2\345\xad\230\xe5\x9c\250\xef\274\x81"); goto OuV1P; WLWHu: $path = $request_data["\160\141\x74\150"]; goto wujvt; WHDDV: return $this->error($name . "\x20\xe6\226\x87\344\xbb\xb6\xe4\xb8\x8d\xe5\xad\x98\xe5\x9c\250\357\274\x81"); goto ANOIF; kgBc4: i3Xel: goto cLgfW; uMIBQ: } protected function postDelete($request_data) { goto DFZmO; vEgK3: E1nOI: goto jGfYo; DFZmO: $ids = $request_data["\151\144"]; goto mv8SC; mv8SC: foreach ($ids as $id) { goto x9y09; jU6sq: @unlink($filename); goto c5gSX; OQ7pN: use7X: goto zsM3I; fUwfJ: if (!$this->db->delete($this->table, array("\x69\144", "\75", $id))->is()) { goto Ys8IE; } goto jU6sq; yUoFl: cTHDs: goto aLEvc; aLEvc: UbBCq: goto VShJU; GfT7H: goto UbBCq; goto FNr_y; deZ3v: if (is_dir($filename)) { goto use7X; } goto bpE26; VzWjG: $name = $file["\x6e\x61\x6d\145"]; goto V8_zA; V8_zA: if (!(!$path || stripos($path, "\x64\x61\x74\x61\57\146\x69\156\x64\x65\162\57") === false || $name == null || $name == '')) { goto K7Hlj; } goto p3AHl; QBttI: goto UbBCq; goto XrobB; tSen7: goto cTHDs; goto s_vL2; c5gSX: Ys8IE: goto AdzPQ; Y3qnI: $path = $file["\160\x61\164\150"]; goto VzWjG; nNweW: $filename = $this->_UTF82GBK("\56\56\57" . $path . $name); goto aNe_g; AdzPQ: goto cTHDs; goto OQ7pN; ZFqg2: $this->_rmdir($filename); goto Koz5t; bpE26: $this->db->delete($this->table, array("\154\x65\x76\145\154", "\x4c\111\x4b\105", "\45\x2c{$id}\x2c\x25")); goto tSen7; Koz5t: V_EJ_: goto yUoFl; s_vL2: eePsU: goto fUwfJ; x9y09: $file = $this->db->select($this->table, array("\x70\141\164\150", "\156\141\x6d\x65"))->where(array("\x69\x64", "\75", $id))->get(); goto AeQoL; aNe_g: if (is_file($filename)) { goto eePsU; } goto deZ3v; AeQoL: if ($file) { goto J31oT; } goto GfT7H; XrobB: K7Hlj: goto nNweW; FNr_y: J31oT: goto Y3qnI; zsM3I: if (!$this->db->delete($this->table, array("\154\x65\166\145\x6c", "\x4c\x49\x4b\105", "\45\x2c{$id}\54\45"))->is()) { goto V_EJ_; } goto ZFqg2; p3AHl: $this->db->delete($this->table, array("\x69\144", "\x3d", $id))->is(); goto QBttI; VShJU: } goto vEgK3; jGfYo: return $this->success(); goto tcoYZ; tcoYZ: } protected function getCurPath($foid) { goto J8cAK; l_pNL: $data = $this->db->select($this->table, array("\151\x64", "\156\141\x6d\145"))->where(array(array("\x69\144", "\111\x4e", $level), "\101\116\104", array("\x74\171\x70\145", "\75", "\146\157\154\144\145\162")))->all(); goto IEJHQ; tAIj7: $level = array_filter(explode("\54", $level)); goto l_pNL; IEJHQ: return $this->success('', $data); goto MnDV6; J8cAK: $level = $this->db->select($this->table, "\x6c\145\166\145\154")->where(array("\x69\144", "\x3d", $foid))->get(0); goto tAIj7; MnDV6: } }
